<!DOCTYPE html><html lang="es"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>TPS Cotizador</title><script src="https://cdn.tailwindcss.com"></script><script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script></head><body class="bg-gray-100 p-4 min-h-screen"><h1 class="text-xl font-bold text-center text-sky-700 mb-4">Cotizador TPS</h1><div class="grid md:grid-cols-3 gap-4"><section class="md:col-span-2 bg-white p-4 rounded-xl shadow"><h2 class="text-lg font-semibold mb-2">Catálogo</h2><div id="errorMsg" class="hidden text-red-600 text-sm mb-2"></div><div class="flex gap-2 mb-3"><input id="filterClave" class="w-1/2 border rounded p-2" placeholder="Clave"><input id="filterDesc" class="w-1/2 border rounded p-2" placeholder="Descripción"></div><div class="overflow-x-auto max-h-96"><table class="w-full text-sm border"><thead><tr class="bg-sky-700 text-white"><th class="p-1">Prod</th><th class="p-1">Descripción</th><th class="p-1">Precio</th><th class="p-1">+</th></tr></thead><tbody id="productBody" class="divide-y"></tbody></table></div><div class="flex justify-center items-center gap-2 mt-2"><button id="prevPage" class="px-2 bg-gray-200 rounded">&lt;</button><span id="pageInfo" class="text-sm"></span><button id="nextPage" class="px-2 bg-gray-200 rounded">&gt;</button></div></section><section class="bg-white p-4 rounded-xl shadow flex flex-col"><h2 class="text-lg font-semibold mb-2">Cotización</h2><div class="space-y-2 mb-2 max-h-52 overflow-y-auto"><input id="cliente" class="w-full border rounded p-2" placeholder="Cliente"><input id="fecha" type="date" class="w-full border rounded p-2"><input id="whatsapp" class="w-full border rounded p-2" placeholder="WhatsApp"></div><select id="nivelPrecio" class="border rounded p-2 mb-2"><option value="0">Público</option><option value="0.15">Sub (-15%)</option><option value="0.20">Dist (-20%)</option></select><div class="overflow-x-auto flex-1"><table class="w-full text-xs border"><thead><tr class="bg-sky-700 text-white text-center"><th class="p-1">#</th><th class="p-1">Prod</th><th class="p-1">Desc</th><th class="p-1">Cant</th><th class="p-1">P.Unit</th><th class="p-1">Total</th></tr></thead><tbody id="cartBody" class="divide-y text-center"><tr><td colspan="6" class="p-2 text-gray-500 italic">Añade productos…</td></tr></tbody></table></div><div class="text-right text-sm mt-1"><div>Subtotal: <span id="subTotal">$0</span></div><div>IVA 16%: <span id="iva">$0</span></div><div class="font-semibold text-lg">Total: <span id="total">$0</span></div><div id="totalLetra" class="text-xs text-gray-500"></div></div><div class="flex gap-2 mt-3"><button id="btnPDF" class="flex-1 bg-sky-600 text-white p-2 rounded">PDF</button><button id="btnWhats" class="flex-1 bg-green-500 text-white p-2 rounded">WhatsApp</button></div></section></div><script>const CSV='https://raw.githubusercontent.com/raulancona/cotizadortps/main/Lista%20estandar%20Raul.csv',ROWS=10,$=e=>document.getElementById(e),fmt=n=>n.toLocaleString('es-MX',{style:'currency',currency:'MXN'});let prod=[],fil=[],page=1,cart=[];function load(){Papa.parse(CSV,{download:!0,header:!0,complete:r=>{prod=r.data.map(o=>{let k={};Object.keys(o).forEach(c=>k[c.trim().toLowerCase()]=o[c]);return{p:k['producto']||'',d:k['descripción']||'',pr:+String(k['precio']||'0').replace(/[$,\s]/g,'')}}).filter(x=>x.p&&x.pr);fil=[...prod];render();},error:e=>alert(e.message)})}function render(){let b=$('productBody');b.innerHTML='';let pages=Math.max(1,Math.ceil(fil.length/ROWS));page=Math.min(page,pages);$('pageInfo').textContent=`${page}/${pages}`;$('prevPage').disabled=page==1;$('nextPage').disabled=page==pages;fil.slice((page-1)*ROWS,page*ROWS).forEach(o=>{let tr=document.createElement('tr');tr.innerHTML=`<td class="p-1">${o.p}</td><td class="p-1">${o.d}</td><td class="p-1 text-right">${fmt(o.pr)}</td><td class="p-1 text-center"><button data-k="${o.p}" class="bg-sky-600 text-white px-1">+</button></td>`;b.appendChild(tr)});b.querySelectorAll('button').forEach(btn=>btn.onclick=()=>add(btn.dataset.k))}function add(k){let it=prod.find(x=>x.p==k);if(!it)return;let ln=cart.find(x=>x.p==k);ln?ln.c++:cart.push({...it,c:1});upd()}function upd(){let d=parseFloat($('nivelPrecio').value);cart.forEach(l=>{l.pu=l.pr*(1-d);l.t=l.pu*l.c});let tb=$('cartBody');tb.innerHTML='';if(!cart.length){tb.innerHTML='<tr><td colspan="6" class="p-2 text-gray-500 italic">Añade productos…</td></tr>';tot(0);return}cart.forEach((l,i)=>{let tr=document.createElement('tr');tr.innerHTML=`<td class="p-1">${i+1}</td><td class="p-1">${l.p}</td><td class="p-1 text-left">${l.d}</td><td class="p-1"><input type="number" min="1" value="${l.c}" data-i="${i}" class="w-12 border text-center"></td><td class="p-1">${fmt(l.pu)}</td><td class="p-1">${fmt(l.t)}</td>`;tb.appendChild(tr)});tb.querySelectorAll('input').forEach(inp=>inp.onchange=e=>{let i=e.target.dataset.i;cart[i].c=Math.max(1,+e.target.value);upd()});tot(cart.reduce((s,l)=>s+l.t,0))}function tot(s){$('subTotal').textContent=fmt(s);$('iva').textContent=fmt(s*.16);let t=s*1.16;$('total').textContent=fmt(t);$('totalLetra').textContent=numLet(t)}function numLet(n){let ent=Math.floor(n),cen=Math.round((n-ent)*100);return `${Intl.NumberFormat('es-MX',{style:'currency',currency:'MXN',maximumFractionDigits:0}).format(ent).replace('$','')} ${cen.toString().padStart(2,'0')}/100 MXN`}function buildPdf(){if(!cart.length)return alert('Carrito vacío');let cli=$('cliente').value||'Cliente',fecha=$('fecha').value||new Date().toISOString().slice(0,10);let body=[[{text:'Producto',bold:!0},{text:'Descripción',bold:!0},{text:'Cant',bold:!0},{text:'P.Unit',bold:!0},{text:'Importe',bold:!0}]];cart.forEach(l=>body.push([l.p,l.d,l.c+"",fmt(l.pu),fmt(l.t)]));let sub=cart.reduce((s,l)=>s+l.t,0),iva=sub*.16,total=sub+iva;let doc={pageMargins:[40,60,40,60],content:[{text:'COTIZACIÓN',style:'h1'},{text:`Fecha: ${fecha}        Cliente: ${cli}\n\n`},{table:{headerRows:1,widths:['*','*','auto','auto','auto'],body},layout:'lightHorizontalLines'},{text:`\nSubtotal: ${fmt(sub)}\nIVA 16%: ${fmt(iva)}\nTOTAL: ${fmt(total)}`,alignment:'right',margin:[0,10,0,0]},{text:numLet(total),alignment:'right',italics:!0,fontSize:9,margin:[0,4,0,0]},{text:'Cotización válida 30 días',fontSize:8,margin:[0,12,0,0]}],styles:{h1:{fontSize:16,bold:!0,alignment:'center'}}};pdfMake.createPdf(doc).download(`Cotizacion_${cli}_${fecha}.pdf`)}function wa(){let tel=$('whatsapp').value.trim();if(!tel)return alert('Ingresa WhatsApp');window.open(`https://wa.me/${tel}`)}$('prevPage').onclick=()=>{page--;render()};$('nextPage').onclick=()=>{page++;render()};$('filterClave').oninput=$('filterDesc').oninput=()=>{let c=$('filterClave').value.toLowerCase(),d=$('filterDesc').value.toLowerCase();fil=prod.filter(x=>x.p.toLowerCase().includes(c)&&x.d.toLowerCase().includes(d));page=1;render()};$('nivelPrecio').onchange=upd;$('btnPDF').onclick=buildPdf;$('btnWhats').onclick=wa;$('fecha').value=new Date().toISOString().slice(0,10);load();</script></body></html>
